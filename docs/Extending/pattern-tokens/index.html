<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Extending/pattern-tokens">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Pattern Tokens | SLOP - Expression Language</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="http://www.slop.dev/slop-site/img/slop-pic.png"><meta data-rh="true" name="twitter:image" content="http://www.slop.dev/slop-site/img/slop-pic.png"><meta data-rh="true" property="og:url" content="http://www.slop.dev/slop-site/docs/Extending/pattern-tokens"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="expression, language"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Pattern Tokens | SLOP - Expression Language"><meta data-rh="true" name="description" content="Although this section is not strictly necessary for extending SLOP, it describes the mechanism through which more"><meta data-rh="true" property="og:description" content="Although this section is not strictly necessary for extending SLOP, it describes the mechanism through which more"><link data-rh="true" rel="icon" href="/slop-site/img/slop.ico"><link data-rh="true" rel="canonical" href="http://www.slop.dev/slop-site/docs/Extending/pattern-tokens"><link data-rh="true" rel="alternate" href="http://www.slop.dev/slop-site/docs/Extending/pattern-tokens" hreflang="en"><link data-rh="true" rel="alternate" href="http://www.slop.dev/slop-site/docs/Extending/pattern-tokens" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/slop-site/blog/rss.xml" title="SLOP - Expression Language RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/slop-site/blog/atom.xml" title="SLOP - Expression Language Atom Feed"><link rel="stylesheet" href="/slop-site/assets/css/styles.a83b87ee.css">
<link rel="preload" href="/slop-site/assets/js/runtime~main.7f4510af.js" as="script">
<link rel="preload" href="/slop-site/assets/js/main.f18e96f3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/slop-site/"><div class="navbar__logo"><img src="/slop-site/img/slop-pic.png" alt="Single Line Operations Processor (SLOP)" class="themedImage_ToTc themedImage--light_HNdA"><img src="/slop-site/img/slop-pic.png" alt="Single Line Operations Processor (SLOP)" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">SLOP</b></a><a class="navbar__item navbar__link" href="/slop-site/blog">News</a><a class="navbar__item navbar__link" href="/slop-site/quick-start">Quick Start</a><a class="navbar__item navbar__link" href="/slop-site/why">Why?</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/slop-site/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/slop-site/license">License</a></div><div class="navbar__items navbar__items--right"><a href="https://gitlab.com/tronied/slop" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Gitlab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/slop-site/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/slop-site/docs/Language/overview">Language</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/slop-site/docs/Extending/design-approach">Extending</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/slop-site/docs/Extending/design-approach">Design Approach</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/slop-site/docs/Extending/grammar">Grammar</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/slop-site/docs/Extending/type-operations">Adding Types / Operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/slop-site/docs/Extending/custom-operators">Custom Operators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/slop-site/docs/Extending/adding-statements">Adding Statements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/slop-site/docs/Extending/pattern-tokens">Pattern Tokens</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/slop-site/docs/support">Questions &amp; Answers</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/slop-site/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Extending</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Pattern Tokens</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Pattern Tokens</h1><p>Although this section is not strictly necessary for extending SLOP, it describes the mechanism through which more
complex tokens (statements) are identified and updated. As opposed to the standard literal tokens which use regular
expressions to match and have their values set, statements are added to a stack and appended to until the token is
marked as complete and added to the list of resulting tokens.</p><p>Without wanting to skip over how literals are scanned, a loop scans through the expression String and each token&#x27;s
pattern is then evaluated against it to see if there is a match. Take the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">12345.99 + 100 / 50</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using the following token patterns:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DecimalToken = ^-?[0-9]+\.[0-9]+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IntegerToken = ^-?[0-9]+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OperatorToken = ^(\+\+|--|\+|-|\/|\*|&gt;=|&lt;=|&lt;|&gt;|%|!=|==)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can perform a loop now on the expression, removing each match until it is empty. The String is trimmed after each
iteration which matches other languages where whitespace is ignored. Using this we see the following iteration events:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1) DecimalToken matched with value &#x27;12345.99&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2) OperatorToken matched with the value &#x27;+&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3) IntegerToken matched with the value &#x27;100&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4) OperatorToken matched with value &#x27;/&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5) IntegerToken matched with value &#x27;50&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is a very simple example, but the same basic premise is used for statements. The only difference here is that the
grammar pattern is mapped into a series of hierarchical pattern tokens. This is used to keep track of the location of
the last read token and what we are expecting the next token to be. For example, using the OperatorToken as an example
which has the following pattern:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;(&#x27; expr &#x27;)&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is mapped to the following pattern:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GrammarGroup(position = 0, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GrammarValue(&#x27;(&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GrammarExpression(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GrammarValue(&#x27;)&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All pattern tokens (even if they are not part of a defined group in the pattern) will be part of a GrammarGroup. This
is because the GrammarGroup is used to record and track the current position within the token. If we assume that we
only have this statement in the list of token handlers, with the following expression:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1 + (2 + 3)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We first read the Integer and Operator tokens and add them to the resulting token list. However, when we get to
the &#x27;(&#x27;, none of the literals trigger a match. A check of the topmost stack item is made first to ensure that it is
not the next logical token in that. As our stack is empty however, we look for a new match in the token handlers
list and find a match with the OperatorToken. A new instance of that token is created and added to the top of the stack
and the parent GrammarGroup pattern token&#x27;s position is updated to 1. The position always points to the next expected
token that the token is expecting. In this case the positions are 0-indexed hence 1 pointing to the GrammarExpression.</p><p>The Lexer then reads three more tokens which are an IntegerToken, OperatorToken and a final IntegerToken. As the next
token after the GrammarExpression is a closing bracket &#x27;)&#x27;, all of these get added to the child token list of the
OperatorToken. Finally the closing brace is read, the tokens position is updated and marked as complete and removed
from the top of the stack and added to the resulting token list:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[== Resulting Tokens ==]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IntegerToken(1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OperatorToken(+),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OperationToken(tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TokenGroup(tokens = [      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IntegerToken(2),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperatorToken(+),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IntegerToken(3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is a very simple example, but what happens if we have embedded statements? This is where the stack comes more
into play. Let&#x27;s take the following expression as an example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">((1 - 2) * 3) / 4 &lt; -1 ? &quot;no&quot; : &quot;yes&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the above although it may look simple, we have 3 levels of statements being processed. For this example I will
describe each stage and provide the state of the stack. In the beginning our stack is empty and our first read
token is an open bracket. Like the last example we have a match in the OperationToken which gets created and added
to the top of the stack. Unlike last time though, the next read token is also an open bracket. As our top-most
stack item is not expecting a closing bracket without at least some content, we look to the token handler list
and again match the OperationToken which again gets created and added to the stack.</p><p>After the first two tokens have been evaluated, this is the state of our stack:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[== Stack ==]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OperationToken(position = 1, tokens = []) &lt;-- Stack Top</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OperationToken(position = 1, tokens = [])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The next three tokens are read and as they are two literals and an operator they are added to the top-most stack item.
The next token is a closing bracket which matches the next logical token in our top-most stack item. As such, it&#x27;s
position is increased to the next logical token. In this case though as there are only 3 pattern tokens that form the
OperatorToken, the position actually exceeds the number of tokens. This triggers the token to be flagged as complete.
The current state of the stack matches the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[== Stack ==]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OperationToken(position = 3, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TokenGroup(tokens = [      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IntegerToken(1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperatorToken(-),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IntegerToken(2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OperationToken(position = 1, tokens = [])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Prior to the next token being read, a check is made to check the state of the current top-most stack item. In this case
it is found to be complete and as such it is removed from the stack and because the stack is not empty added as a child
of the next stack item:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[== Stack ==]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OperationToken(position = 1, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TokenGroup(tokens = [      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperationToken(position = 3, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TokenGroup(tokens = [                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                IntegerToken(1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                OperatorToken(-),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                IntegerToken(2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Two more tokens are then read which are an OperatorToken(*) and an IntegerToken(4). These are added to the top-most stack
item and a final closing brace is recorded which causes the last remaining item on the stack to be marked as complete:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[== Stack ==]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OperationToken(position = 3, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TokenGroup(tokens = [      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperationToken(position = 3, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TokenGroup(tokens = [                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                IntegerToken(1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                OperatorToken(-),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                IntegerToken(2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]),            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperatorToken(*),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IntegerToken(3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]),    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The OperationToken as the last remaining token is popped from the top of the stack and added to the resulting list of tokens.
Four more tokens are read and added to the token list which are the OperatorToken(/), IntegerToken(4), OperatorToken(&lt;) and
finally an IntegerToken(-1). Without moving into the job of the Parser, if the expression ended here this would result in
a condition which would result in a Boolean. As it is, the list of tokens looks like the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[== Resulting Tokens ==]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OperationToken(position = 3, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TokenGroup(tokens = [  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperationToken(position = 3, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TokenGroup(tokens = [              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                IntegerToken(1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                OperatorToken(-),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                IntegerToken(2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]),            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperatorToken(*),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IntegerToken(3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]),    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OperatorToken(/),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IntegerToken(4),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OperatorToken(&lt;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IntegerToken(-1)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Something then unexpected happens where we find a &#x27;?&#x27; token. This is part of a token called a Conditional which has the
following grammar pattern:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">expr &#x27;?&#x27; expr &#x27;:&#x27; expr</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>What is strange about this is that we had no prior warning that the previously lexed tokens were part of a statement. You
may also notice that the &#x27;?&#x27; is not the first token in the pattern. Since that was an expression capture group, the first which
can be matched is actually the second token which says something about the statement&#x27;s nature. The conditional is greedy and
scoops up tokens immediately before and after as it has no strict opening and closing syantax tags. The start and end of the
statement can be identified by looking at those which share the same level / scope as the statement itself. For this
example a match is made against the ConditionalToken and a new instance added onto the stack with all prior tokens added.
The new state of the stack looks like the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[== Stack ==]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ConditionalToken(position = 2, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TokenGroup(tokens = [    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperationToken(position = 3, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TokenGroup(tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                OperationToken(position = 3, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    IntegerToken(1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    OperatorToken(-),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    IntegerToken(2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            OperatorToken(*),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            IntegerToken(3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperatorToken(/),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IntegerToken(4),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperatorToken(&lt;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IntegerToken(-1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]),    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As the active token is now a different grammar expression, all captured tokens will be written to a new token group. As
there is only a single String token, that is added to that. The next token is a &#x27;:&#x27; which matches the next logical token
of the head of the stack in the Conditional statement. The position is incremented again to the position past the last
token so that it now points to position 4 which is the last &#x27;expr&#x27; capture group. As the last remaining token is a
solitary StringToken as well, the final picture of the stack prior to the ConditionalToken being removed looks like the
following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[== Stack ==]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ConditionalToken(position = 4, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TokenGroup(tokens = [    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OperationToken(position = 3, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IntegerToken(-1)        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TokenGroup(tokens = [    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StringToken(&quot;no&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TokenGroup(tokens = [    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StringToken(&quot;yes&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]),        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As the lexer has now reached the end of the expression and there are no further tokens to be added, a finalizeExpression
method is called which removes any tokens still on the stack (in this case the ConditionalToken) and adds it to the
resulting token list. These are then returned to the SLOPProcessor and can either be serialized to a String or File or
passed to the Parser for evaluation and resolution.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-grammar--pattern-flags">Additional Grammar / Pattern Flags<a class="hash-link" href="#additional-grammar--pattern-flags" title="Direct link to heading">â€‹</a></h2><p>In the above section we have covered how pattern tokens are used by the Lexer to keep track of where in the statement
read tokens belong. There are several grammar flags which cause this flow to be disrupted or change. The first of these
is the &#x27;+&#x27; flag which can be applied to any Grammar Group in a String. For example, taking the FieldToken pattern we
can see this being used to represent a repeating pattern:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> val </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;[&#x27;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">expr</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;]&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">? </span><span class="token string" style="color:#e3116c">&#x27;.&#x27;</span><span class="token plain">? </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The entire pattern is wrapped in a parent grammar group which can be repeated one or more times (denoted by the following
&#x27;+&#x27; character). Inside is a &#x27;val&#x27; representing a single value capture group with an optional following grammar group
(denoted by the following &#x27;?&#x27;) with a set of square brackets surrounding an expression capture group. Finally this is
followed by an optional syntax period character (&#x27;.&#x27;). If we provide some examples it should become clear as to the
values it is trying to capture:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">object.field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object.collection[0].field</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object.map[&quot;value&quot; + 1]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As can be seen some of the examples have index / key references whilst others do not. This is where the &#x27;?&#x27; tokens allows
optional values to be captured. Going further we can split the middle example up to the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">object.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collection[0].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">field</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Each one represents an individual capture event of the repeated grammar group pattern defined above. Likewise, each one
will be captured in its own TokenGroup. Let&#x27;s then start running over the above example and see how the pattern tokens
are structured and see how the Lexer handles them. The grammar lexer will output the following pattern tokens onto the
FieldToken when SLOP is initialised:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GrammarGroup(position = 0, multiple = true, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GrammarValue(capture = true),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GrammarGroup(position = 0, optional = true, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GrammarValue(&#x27;[&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GrammarExpression(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GrammarValue(&#x27;]&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GrammarValue(value = &#x27;.&#x27;, optional = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Reading the expression String &#x27;object.collection<!-- -->[0]<!-- -->.field&#x27;, the first read token is a TokenValue(&#x27;object&#x27;) and so far
no match occurs is found in our pattern as it is too generic. Keep in mind that a match only happens if an identifying
tag (typically syntax) is read. The next token however is a match for the &#x27;.&#x27; found following the optional grammar group.
This may seem a bit odd as we have skipped the entire second GrammarGroup, but keep in mind the Lexer will only apply
strict matching if it is required. As this is optional, it skipped ahead and looked for a matching token which it found
in the optional GrammarValue(&#x27;.&#x27;). Upon finding this match, a new instance of the FieldToken is added to the top of the
stack and TokenValue(&#x27;object&#x27;) is added into a TokenGroup.</p><p>The position of the group is then set to the position after the &#x27;.&#x27; which in this case exceeds the number of pattern
tokens in the group. A check is triggered and since the group supports multiple occurances, it&#x27;s position and all
contained group positions are reset back to their initial positions. At this stage the state of the stack looks like
the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[== Stack ==]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FieldToken(tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TokenGroup(tokens = [    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TokenValue(&#x27;object&#x27;)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The next token is another TokenValue(&#x27;collection&#x27;) which gets added to the short term memory list of tokens. This is used
to store recently read tokens which we&#x27;re not quite sure what to do with yet. The next token is a TokenValue(&#x27;[&#x27;) which
triggers a match in the FieldToken on the stack but for a different reason than the previous. On this occasion instead
of skipping over the optional group it has found a match in the starting syntax token. Looking at the pattern tokens
again we can see how the positions are updated to reflect this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GrammarGroup(position = 1, multiple = true, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GrammarValue(capture = true),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GrammarGroup(position = 1, optional = true, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GrammarValue(&#x27;[&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GrammarExpression(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GrammarValue(&#x27;]&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GrammarValue(value = &#x27;.&#x27;, optional = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The current active pattern token is a grammar expression and will be used to capture any tokens found within the square
brackets. In our case it is just a single IntegerToken(0) and after the subsequent closing TokenValue(&#x27;]&#x27;) is read, the
stack looks like the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[== Stack ==]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FieldToken(tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TokenGroup(tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TokenGroup(tokens = [    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TokenValue(&#x27;object&#x27;)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TokenGroup(tokens = [    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TokenValue(&#x27;collection&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TokenGroup(tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                IntegerToken(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ])  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The pattern tokens with their positions are the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[== Pattern Tokens ==]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GrammarGroup(position = 2, multiple = true, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GrammarValue(capture = true),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GrammarGroup(position = 3, optional = true, tokens = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GrammarValue(&#x27;[&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GrammarExpression(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GrammarValue(&#x27;]&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GrammarValue(value = &#x27;.&#x27;, optional = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The current active token is pointing to the GrammarValue(&#x27;.&#x27;) which is the next token read by the Lexer. Again the
position is updated and the group is marked as complete, a check is performed to determine whether it can be captured
multiple times (which it can) and again the position of the group reset.</p><p>Finally we are on the last iteration through the FieldToken with the last remaining token being read which is a
GrammarValue(&#x27;field&#x27;). In this case though we have no clear closing syntax as fields are not followed by a &#x27;.&#x27;. This
is where the Lexer has to use a bit of deductive reasoning which differs depending on the scenario. In our case we
have a single value and the end of the expression was met. As such, it is a safe bet to add it to the top stack
item. If we had the following scenario however:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">object.collection[0].field * 40</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Lexer would then look at the top item in the stack and the following tokens to make a best guess. In this situation
the FieldToken does support a single TokenValue and is a valid match against the tokens pattern. Since that has a higher
probability of a match rather than existing as a single TokenValue between the statement and an Operator / Integer token,
again it is safe to assume that it can be added to that item.</p><p>This covers the process by which the Lexer matches tokens against statements using pattern tokens and how it deals with
the different types of grammar flags. As mentioned previously, this information is not strictly required for writing your
own statements, but it is useful to understand why tokens are organised into the groups they are and the mechanism used
to facilitate this.</p><p><strong>NOTE</strong>: Although not covered here, when a grammar group is marked to capture multiple sets of tokens (as above), if
it is found that the group is in its reset state (complete) but a following token after that group triggers a match,
the token position will be moved to that location to avoid being stuck in an endless cycle of repetitions. The lexer
uses intelligent look ahead in this scenario.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://gitlab.com/tronied/slop/docs/Extending/pattern-tokens.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/slop-site/docs/Extending/adding-statements"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Adding Statements</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/slop-site/docs/support"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Questions &amp; Answers</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#additional-grammar--pattern-flags" class="table-of-contents__link toc-highlight">Additional Grammar / Pattern Flags</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/slop-site/quick-start">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/slop-site/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://slop.boards.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/slop-site/blog">News</a></li><li class="footer__item"><a href="https://gitlab.com/tronied/slop" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitlab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Robert Meyer. Built with Docusaurus.</div></div></div></footer></div>
<script src="/slop-site/assets/js/runtime~main.7f4510af.js"></script>
<script src="/slop-site/assets/js/main.f18e96f3.js"></script>
</body>
</html>